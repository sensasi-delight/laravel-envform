# Implementation Plan: Value Resolver Service

**Branch**: `005-value-resolver` | **Date**: 2026-01-24 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/005-value-resolver/spec.md`

## Summary

The `ValueResolver` feature introduces a centralized service to resolve configuration values across multiple sources (FormValue, DotEnv, Config, and Derivations). This ensures that "magic" defaults in Laravel, such as the implicit derivation of `DB_CACHE_LOCK_TABLE` from `DB_CACHE_TABLE`, are explicitly handled and presented to the user during the environment configuration process.

## Technical Context

**Language/Version**: PHP 8.2+
**Primary Dependencies**: laravel/prompts, illuminate/support (^12.0), nikic/php-parser
**Testing**: PHPUnit 12+, Orchestra Testbench
**Target Platform**: CLI (Laravel 12 Applications)
**Project Type**: Laravel Development Package
**Quality Standards**: strict_types=1, PHPStan Level 8, Laravel Pint

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- [x] **Deterministic Integrity**: Does this feature rely on AST analysis rather than heuristics? (Yes, it uses explicit derivation rules).
- [x] **Strict Boundary Separation**: Does logic live in Services, and raw access in Repositories? (Yes, `ValueResolver\Service` and `ValueResolver\Repository`).
- [x] **Privacy First**: Is all processing 100% local with zero outbound connections? (Yes).
- [x] **Explicit Configuration**: Does this avoid "magic" defaults in favor of explicit .env values? (Yes, it surfaces derived values as explicit defaults).
- [x] **Quality Mandate**: Will the implementation include `declare(strict_types=1)` and pass PHPStan L8? (Yes).

## Project Structure

### Documentation (this feature)

```text
specs/005-value-resolver/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
src/
├── ValueResolver/       # Centralized value resolution logic
│   ├── Service.php      # Priority-based resolution orchestration
│   └── Repository.php   # Loader for resources/derivations.php
├── Wizard/
│   └── Service.php      # Updated to consume ValueResolver
resources/
└── derivations.php      # Rule definitions for implicit values

tests/
├── Unit/ValueResolver/
└── Feature/ValueResolver/
```

**Structure Decision**: Single project package structure with conceptual module boundaries.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| None | N/A | N/A |
